# API密钥持久化加载提案

## 变更概述
解决前端AI模型配置下的API密钥在浏览器关闭后丢失的问题，实现从后端数据库的持久化加载机制。

## 问题背景
当前前端模板中DeepSeek等大模型的API密钥在验证后刷新页面可以存在，但关闭浏览器再打开就会丢失。这是因为：

1. API密钥只在当前用户会话期间从数据库加载
2. 浏览器关闭后会话结束，重新打开时无法获取之前的API密钥
3. 前端模板依赖Jinja2模板变量显示API密钥，但没有持久化机制

## Why
用户体验问题：用户每次打开浏览器都需要重新输入和验证API密钥，这造成了不便并降低了应用的使用效率。实现API密钥的持久化加载可以显著改善用户体验，让用户能够无缝继续之前的工作。

## 解决方案
实现基于用户标识的API密钥持久化加载机制，确保：
1. 使用稳定的用户标识（如session_id或用户ID）
2. 在页面加载时自动从后端数据库获取已保存的API密钥
3. 保持API密钥的安全性和加密存储
4. 提供统一的API密钥管理接口

## 技术方案
- 修改后端路由，在页面渲染时从数据库加载API密钥
- 增强前端JavaScript，支持API密钥的异步加载和显示
- 改进配置服务，提供可靠的API密钥获取机制
- 确保API密钥在前端显示时进行适当遮蔽

## What Changes
1. **后端API密钥加载机制**：修改首页路由，在页面渲染时从数据库加载用户已保存的API密钥
2. **前端模板显示逻辑**：更新模板变量处理，确保API密钥以遮蔽形式正确显示
3. **配置服务增强**：改进API密钥获取方法，支持按用户标识查询
4. **用户体验优化**：实现跨会话的API密钥持久化显示

## 预期效果
用户关闭浏览器后重新打开，仍能在前端看到之前配置和验证过的API密钥，提升用户体验。